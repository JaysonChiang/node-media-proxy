<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>
            Media Server
        </title>
        <link rel="stylesheet" href="./css/style.css">
        <script src="app/bower_components/jsmpeg/jsmpg.js"></script>
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    </head>
    <body>

        <h1>
            RTSP Feed
        </h1>

        <input type="text" id="url"/>
        <input type="button" id="pressme" value="Press"/>

        <h1>
            WS Feed
        </h1>

        <input type="text" id="ws"/>
        <input type="button" id="press_ws" value="Press"/>

        <canvas id="canvas" style="width: 500px; height: 300px;">
        </canvas>

        <script>
            var player;

            function playVideo(url) {
                var canvas = document.getElementById('canvas');
                var client = new WebSocket(url);

                setTimeout(function() {
                    var player = new jsmpeg(client, {
                        canvas: canvas
                    });
                }, 2000);

                console.log({
                    player: player
                });
            }

            $(document).ready(function() {
                var button = document.getElementById('pressme');
                var buttonWs = document.getElementById('press_ws');
                var url = document.getElementById('url');
                var urlWs = document.getElementById('ws');


                button.onclick = function() {
                    $.ajax({
                        type: 'POST',
                        url: '/get_stream',
                        processData: false,
                        contentType: 'application/json',
                        data: JSON.stringify({
                            "streamUrl": url.value
                        }),
                        success: function(r) {
                            playVideo(r.proxy);
                        }
                    });
                };

                buttonWs.onclick = function() {
                    playVideo(urlWs.value);
                };
            });
        </script>
    </body>
</html>
